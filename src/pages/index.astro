---
import Layout from "../layouts/Layout.astro";

import Badge from "../components/Badge.astro";
import SocialMedia from "../components/SocialMedia.astro";
import Experience from "../components/Experience.astro";

import LinkedIn from "../icons/LinkedIn.astro";
import Gmail from "../icons/Gmail.astro";
import CV from "../icons/CV.astro";
import Code from "../icons/Code.astro";

import foto from "../../public/foto.webp"; // mueve foto.webp a src/assets si a√∫n est√° en /public


import { getCollection, render } from "astro:content";
const projects = (await getCollection("projects"))
  .sort((a, b) => (a.data.priority ?? 99) - (b.data.priority ?? 99));

const experiences = (await getCollection("experiences"))
  .sort((a, b) => (a.data.priority ?? 99) - (b.data.priority ?? 99));
---

<Layout
	title="Portfolio de Jorge Larrosa Quesada - Desarrollador y Programador de XR y Web con experiencia en Unity"
	description="Contrata a Jorge Larrosa Quesada para proyectos de XR y Web. Desarrollador de Realidad Mixta y Virtual con experiencia en Unity."
>
	<main id="inicio">
		<section
			id="sobre-mi"
			class="w-full mx-auto max-w-[740px] py-8 sm:py-20 md:pt-44 lg:pt-44 px-4 text-center lg:text-left md:text-left xs:py-1"
		>
			<div data-animate
			class="will-change-transform motion-safe:animate-fade-slide-in motion-reduce:animate-none">
				<!-- Foto -->
				<img
					class="rounded-full size-24 sm:size-28 md:size-32 mb-6 mx-auto lg:mx-0 md:mx-0 object-cover object-top"
					src={foto.src}
					width={foto.width}
					height={foto.height}
					alt="Foto de Jorge"
					loading="eager"
					fetchpriority="high"
					decoding="async"
					/>

				<!-- T√≠tulo -->
				<h1
					
					class="text-3xl sm:text-4xl lg:text-5xl font-bold flex flex-col lg:flex-row md:flex-row lg:items-center gap-4 pb-8"
					
				>
					Hey, soy Jorge
					<a
						href="https://www.linkedin.com/in/jorge-larrosa-quesada/"
						target="_blank"
						rel="noopener"
						class="flex justify-center lg:justify-start"
					>
						<Badge>Actualmente trabajando</Badge>
					</a>
				</h1>
			</div>

			<div data-animate
				class="will-change-transform motion-safe:animate-fade-slide-in motion-reduce:animate-none">
				<!-- Subt√≠tulo -->
				<h2 text-wrap:balance class="text-pretty text-lg sm:text-xl lg:text-2xl space-y-2">
					<span
						>üíª Desarrollador de <span class="text-blue-400">XR</span> y
						<span class="text-pink-400">Web</span>.</span
					>
					<span class="text-blue-200/90">‚è≥ +2 a√±os de experiencia.</span>
					<span class=""
						>Trabajando en <span class="text-orange-400">ITI</span> üöÄ.</span
					>
					<span class="text-gray-300/90">
						Especializado en <span class="text-purple-400 font-semibold"
							>Realidad Mixta</span
						> y
						<span class="text-indigo-400 font-semibold">Virtual</span>.
					</span>
					<span class="opacity-80">Alicante, Espa√±a.</span>
				</h2>

				<!-- Redes sociales -->
				<nav
					class="flex flex-wrap justify-center lg:justify-start gap-3 mt-8"
				>
					<SocialMedia
						href="https://www.linkedin.com/in/jorge-larrosa-quesada/"
					>
						<LinkedIn class="size-5" />
						LinkedIn
					</SocialMedia>
					<SocialMedia href="mailto:jorgelarrosaquesada@gmail.com">
						<Gmail class="size-5" />
						Gmail
					</SocialMedia>
					<SocialMedia
						href="/Curr√≠culum.pdf"
						download="Jorge_Larrosa_CV.pdf"
						target="_blank"
					>
						<CV class="size-5" />
						Curr√≠culum
					</SocialMedia>
				</nav>
			</div>
		</section>

		<section 
			id="experiencia"
			data-animate
			class="w-full mx-auto max-w-[740px] py-20 sm:py-20 lg:pt-10 px-4 text-center lg:text-left  will-change-transform motion-safe:animate-fade-slide-in motion-reduce:animate-none"
		>
			<h2 class="text-3xl font-semibold mb-10 flex items-center gap-x-3">
				Experiencia
			</h2>
			{await Promise.all(
				experiences.map(async (experience) => {
				  const { data } = experience;
				  const { title, working, date, archivo, type } = data;
			  
				  // Mejor: usa la API del entry
				  const { Content } = await experience.render();
			  
				  return (
					<Experience
					  title={title}
					  working={working ?? false}
					  date={date}
					  archivo={archivo}
					  type={type}
					>
					  <Content />
					</Experience>
				  );
				})
			  )}
		</section>

		<section
			id="proyectos"
			data-animate
			class="w-full mx-auto max-w-[740px] py-20 sm:py-20 lg:pt-10 px-4 lg:text-left
					will-change-transform motion-safe:animate-fade-slide-in motion-reduce:animate-none"
			aria-labelledby="proyectos-heading"
			>
			<h2 id="proyectos-heading" class="text-3xl font-semibold mb-6 flex items-center gap-x-3">
				<Code class="size-10" />
				Proyectos
			</h2>

			{
				projects.map((project) => {
				const { slug, data } = project;
				const { title, img, description } = data;

				return (
					<div class="grid max-w-screen-xl px-4 py-2 mx-auto lg:gap-8 xl:gap-0 lg:grid-cols-12">
					<div class="pb-8 mr-auto place-self-center lg:col-span-7">
						{/* h3 en lugar de h1 */}
						<h3 class="max-w-2xl mb-4 text-2xl font-extrabold tracking-tight leading-none md:text-2xl xl:text-2xl">
						{title}
						</h3>

						{/* Imagen m√≥vil: ratio fijo para evitar CLS */}
						<div class="ml-2 mb-6 lg:hidden order-2 flex justify-center">
						<div class="w-full max-w-xs aspect-[4/3]">
							<img
							transition:name={`img-${slug}`}
							class="rounded-lg object-contain w-full h-full"
							src={img}
							alt={`Imagen del proyecto: ${title}`}
							loading="lazy"
							decoding="async"
							sizes="(max-width: 640px) 100vw, 320px"
							/>
						</div>
						</div>

						<p class="text-left max-w-2xl mb-6 mr-2 font-light text-gray-500 lg:mb-8 md:text-lg lg:text-xl">
						{description}
						</p>

						<a
						href={`/proyect/${slug}`}
						class="relative inline-flex items-center justify-center p-0.5 mb-2 me-2 overflow-hidden text-sm font-medium rounded-lg group bg-gradient-to-br from-purple-500 to-pink-500 hover:text-white hover:scale-110 focus:ring-4 focus:outline-none focus:ring-purple-200"
						aria-label={`Ver m√°s informaci√≥n del proyecto ${title}`}
						>
						<span class="relative px-5 py-2.5 transition-all ease-in duration-75 bg-white/90 dark:bg-gray-900 rounded-md group-hover:bg-transparent">
							M√°s informaci√≥n
						</span>
						</a>
					</div>

					{/* Imagen desktop: ratio fijo + lazy */}
					<div class="hidden lg:flex lg:col-span-5">
						<div class="w-full max-w-md aspect-[4/3]">
						<img
							transition:name={`img-${slug}`}
							class="rounded-lg object-contain w-full h-full"
							src={img}
							alt={`Imagen del proyecto: ${title}`}
							loading="lazy"
							decoding="async"
							sizes="(min-width: 1024px) 480px, 100vw"
						/>
						</div>
					</div>
					</div>
				);
				})
			}
			</section>
	</main>
</Layout>
